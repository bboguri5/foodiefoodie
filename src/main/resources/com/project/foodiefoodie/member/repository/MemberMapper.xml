<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper태그는 sql을 매핑할때 사용하는 태그
     namespace속성에는 사용할 인터페이스의 풀 패키지경로 + 인터페이스이름
  -->
<mapper namespace="com.project.foodiefoodie.member.repository.MemberMapper">
    
    <resultMap id="memberMap" type="com.project.foodiefoodie.member.domain.Member">
        <result property="nickName" column="nick_name"/>
        <result property="phoneNumber" column="phone_number"/>
        <result property="registDate" column="regist_date"/>
        <result property="loginTime" column="login_time"/>
    </resultMap>
    
    <resultMap id="masterMap" type="com.project.foodiefoodie.member.domain.Master">
        <result property="nickName" column="nick_name"/>
        <result property="phoneNumber" column="phone_number"/>
        <result property="registDate" column="regist_date"/>
        <result property="loginTime" column="login_time"/>
        <result property="businessNo" column="business_no"/>
        <result property="masterName" column="master_name"/>
        <result property="storeName" column="store_name"/>
        <result property="storeAddress" column="store_address"/>
        <result property="foodCategories" column="food_categories"/>
        <result property="storeRegDate" column="store_reg_date"/>
        <result property="hotDeal" column="hot_deal"/>
        <result property="storeCallNumber" column="store_call_number"/>
    </resultMap>

    
    <select id="findAll" resultMap="memberMap">
        SELECT * FROM member
    </select>

    <select id="findCommon" resultMap="memberMap">
        SELECT * FROM member
        WHERE auth = 'COMMON'
    </select>

    <select id="findMaster" resultMap="masterMap">
        SELECT
        a.email, a.nick_name, a.phone_number, a.birth, a.address
        , a.name, a.gender, a.auth, a.regist_date, a.login_time
        , b.business_no, b.store_name, b.store_address, b.food_categories
        , b.store_reg_date, b.hot_deal, b.store_call_number
        FROM member a
        LEFT OUTER JOIN master b
        ON a.email = b.email
        WHERE auth = 'MASTER'
    </select>


    <select id="findOneCommon" resultMap="memberMap">
        SELECT * FROM member
        WHERE email = #{email}
    </select>

    <select id="findOneMaster" resultMap="masterMap">
        SELECT
        a.email, a.nick_name, a.phone_number, a.birth, a.address
        , a.name, a.gender, a.auth, a.regist_date, a.login_time
        , b.business_no, b.store_name, b.store_address, b.food_categories
        , b.store_reg_date, b.hot_deal, b.store_call_number
        FROM member a
        LEFT OUTER JOIN master b
        ON a.email = b.email
        WHERE a.email = #{email}
    </select>

    <delete id="remove">
        DELETE FROM member
        WHERE email = #{email}
    </delete>

    <delete id="removeMaster">
        DELETE FROM master
        WHERE email = #{email}
    </delete>

    <select id="approveMaster" resultMap="masterMap">
        SELECT
        a.email, a.nick_name, a.phone_number, a.birth, a.address
        , a.name, a.gender, a.auth, a.regist_date, a.login_time
        , b.business_no, b.store_name, b.store_address, b.food_categories
        , b.store_reg_date, b.hot_deal, b.store_call_number
        FROM member a
        LEFT OUTER JOIN master b
        ON a.email = b.email
        WHERE auth = 'COMMON' AND b.email is not null
    </select>

    
</mapper>